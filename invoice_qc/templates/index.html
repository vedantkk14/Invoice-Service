<!DOCTYPE html>
<html>
<head>
    <title>Invoice QC Web App</title>
    <style>
        body { font-family: Arial; margin: 40px; }
        .container { max-width: 800px; margin: auto; }
        .invoice-box { padding: 15px; border: 1px solid #ddd; margin-top: 20px; }
        .valid { color: green; font-weight: bold; }
        .invalid { color: red; font-weight: bold; }
        pre { background: #f5f5f5; padding: 10px; overflow-x: auto; }
    </style>
</head>

<body>
    <div class="container">
        <h2>Invoice Extraction & QC</h2>

        <form method="POST" enctype="multipart/form-data" action="/upload">
            <label>Select PDF Invoices:</label><br><br>
            <input type="file" name="pdfs" multiple required>
            <br><br>
            <button type="submit">Upload & Validate</button>
        </form>

        {% if extracted %}
            <h3>Extracted Invoices</h3>

            {% for inv in extracted %}
            <div class="invoice-box">
                <h4>File: {{ inv.source_file }}</h4>
                <pre>{{ inv | tojson(indent=2) }}</pre>
            </div>
            {% endfor %}
        {% endif %}

        {% if validation %}
            <h3>Validation Results</h3>

            <p><strong>Total:</strong> {{ validation.summary.total_invoices }}</p>
            <p><strong>Valid:</strong> {{ validation.summary.valid_invoices }}</p>
            <p><strong>Invalid:</strong> {{ validation.summary.invalid_invoices }}</p>

            {% for res in validation.results %}
            <div class="invoice-box">
                <h4>Invoice ID: {{ res.invoice_id }}</h4>
                {% if res.is_valid %}
                    <p class="valid">Valid Invoice ✔</p>
                {% else %}
                    <p class="invalid">Invalid Invoice ✘</p>
                    <strong>Errors:</strong>
                    <ul>
                        {% for e in res.errors %}
                            <li>{{ e }}</li>
                        {% endfor %}
                    </ul>
                {% endif %}
            </div>
            {% endfor %}
        {% endif %}
    </div>
</body>
</html>
